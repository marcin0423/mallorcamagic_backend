{"version":3,"sources":["views/AccountSettings.js"],"names":["passwordReducer","state","action","newState","Object","E_Python_MallorcaMagc_clean_for_deploy_mallorcamagic_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_2__","E_Python_MallorcaMagc_clean_for_deploy_mallorcamagic_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_1__","target","name","value","isValid","current","length","new","confirm","PasswordUpdate","_useReducer","useReducer","_useReducer2","E_Python_MallorcaMagc_clean_for_deploy_mallorcamagic_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__","passwords","dispatch","_useState","useState","_useState2","loading","setLoading","_useState3","_useState4","error","setError","token","useRecoilValue","AuthToken","handleUpdate","useCallback","axios","post","concat","HOST_NAME","current_password","password","headers","Authorization","then","res","catch","err","response","data","finally","react__WEBPACK_IMPORTED_MODULE_4___default","a","createElement","className","react_router_dom__WEBPACK_IMPORTED_MODULE_5__","to","type","onChange","e","disabled","onClick","AccountSettings","_useState5","username","email","_useState6","user","setUser","_useState7","weeklyNews","guideAlart","special","_useState8","checkboxValues","setCheckboxValues","_useState9","userInfo","_useState10","_useRecoilState","useRecoilState","LoggedUser","_useRecoilState2","currentUser","setCurrentIser","navigate","useNavigate","requestTimerRef","useRef","performUpdateInfo","console","log","status","isLoggedIn","useEffect","news_letters","guide_alert","offers_alert","handleUserChange","handleCheckboxChanges","newValues","checked","clearTimeout","setTimeout","handleSave","_containers_DefaultLayout__WEBPACK_IMPORTED_MODULE_9__","placeholder"],"mappings":"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","file":"static/js/21.5dc33152.chunk.js","sourcesContent":["import axios from \"axios\";\r\nimport React, { useCallback, useEffect, useReducer, useRef, useState } from \"react\";\r\nimport { Link, useNavigate } from \"react-router-dom\";\r\nimport { useRecoilState, useRecoilValue } from \"recoil\";\r\nimport { HOST_NAME } from \"../config\";\r\nimport { DefaultLayout } from '../containers/DefaultLayout';\r\nimport { AuthToken, LoggedUser } from \"../recoilState/User\";\r\n\r\nconst passwordReducer = (state, action) => {\r\n  const newState = { ...state, [action.target.name]: action.target.value };\r\n  newState.isValid = newState.current.length >= 6 && newState.new.length >= 6 && newState.confirm.length >= 6 && newState.new === newState.confirm;\r\n  return newState;\r\n}\r\n\r\nconst PasswordUpdate = () => {\r\n  const [passwords, dispatch] = useReducer(passwordReducer, { current: \"\", new: \"\", confirm: \"\", isValid: false });\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n  const token = useRecoilValue(AuthToken);\r\n\r\n  const handleUpdate = useCallback(() => {\r\n    if (!passwords.isValid) return;\r\n    setLoading(true);\r\n    setError(\"\");\r\n    axios.post(`${HOST_NAME}api/accounts/change-pass/`, { current_password: passwords.current, password: passwords.new, confirm: passwords.confirm },\r\n      { headers: { Authorization: `Token ${token}` } })\r\n      .then(res => {\r\n        setError(\"Password successfully updated\");\r\n      }).catch(err => setError(err.response.data.error))\r\n      .finally(() => setLoading(false));\r\n  }, [token, passwords, loading, error]);\r\n\r\n  return (\r\n    <div className=\"right\">\r\n      <h2>Change Password</h2>\r\n      <div className=\"input\">\r\n        <div className=\"\">\r\n          <label>Current Password</label>\r\n          <Link to=\"/\">Forget password?</Link>\r\n        </div>\r\n        <input type=\"password\" name=\"current\" value={passwords.current} onChange={(e) => dispatch(e)} />\r\n      </div>\r\n      <div className=\"input\">\r\n        <label>New Password</label>\r\n        <input type=\"password\" name=\"new\" value={passwords.new} onChange={(e) => dispatch(e)} />\r\n      </div>\r\n      <div className=\"input\">\r\n        <label>Confirm New Password</label>\r\n        <input type=\"password\" name=\"confirm\" value={passwords.confirm} onChange={(e) => dispatch(e)} />\r\n      </div>\r\n      {error && <div className=\"error\"><p>{error}</p></div>}\r\n      <button disabled={!passwords.isValid} onClick={handleUpdate} className={loading ? \"loading\" : \"\"}>UPDATE PASSWORD</button>\r\n\r\n    </div>\r\n  );\r\n}\r\n\r\nexport const AccountSettings = () => {\r\n  const [user, setUser] = useState({ username: \"\", email: \"\" })\r\n  const [checkboxValues, setCheckboxValues] = useState({ weeklyNews: false, guideAlart: false, special: false });\r\n  const [loading, setLoading] = useState({ userInfo: false, password: false });\r\n\r\n  const [currentUser, setCurrentIser] = useRecoilState(LoggedUser);\r\n  const token = useRecoilValue(AuthToken);\r\n  const navigate = useNavigate();\r\n\r\n  // Update user information\r\n  const requestTimerRef = useRef(null);\r\n  const performUpdateInfo = useCallback(data => {\r\n    if (data.username) setLoading({ ...loading, userInfo: true });\r\n\r\n    console.log(data);\r\n    axios.post(`${HOST_NAME}api/accounts/update/`, data, { headers: { Authorization: `Token ${token}` } })\r\n      .then(response => {\r\n        if (response.status === 200) {\r\n          setCurrentIser({\r\n            isLoggedIn: true,\r\n            user: response.data\r\n          });\r\n        }\r\n      })\r\n      .catch(error => console.log(error))\r\n      .finally(() => {\r\n        if (data.username) setLoading({ ...loading, userInfo: false });\r\n      });\r\n  }, [user, checkboxValues, token, loading]);\r\n\r\n  useEffect(() => {\r\n    if (currentUser.isLoggedIn) {\r\n      setUser({ username: currentUser.user.username, email: currentUser.user.email });\r\n      setCheckboxValues({ weeklyNews: currentUser.user.news_letters, guideAlart: currentUser.user.guide_alert, special: currentUser.user.offers_alert });\r\n    }\r\n  }, [currentUser]);\r\n\r\n  if (!currentUser.isLoggedIn) {\r\n    navigate(\"/login\");\r\n  }\r\n\r\n  const handleUserChange = useCallback((e) => {\r\n    setUser({ ...user, [e.target.name]: e.target.value });\r\n  }, [user])\r\n\r\n  const handleCheckboxChanges = useCallback((e) => {\r\n    const newValues = { ...checkboxValues, [e.target.name]: e.target.checked };\r\n    setCheckboxValues(newValues);\r\n\r\n    // Send request to update user info\r\n    if (requestTimerRef.current) {\r\n      clearTimeout(requestTimerRef.current);\r\n      requestTimerRef.current = null;\r\n    }\r\n    requestTimerRef.current = setTimeout(() => {\r\n      requestTimerRef.current = null;\r\n      performUpdateInfo({ news_letters: newValues.weeklyNews, guide_alert: newValues.guideAlart, offers_alert: newValues.special });\r\n    }, 1000)\r\n  }, [checkboxValues, setCheckboxValues, requestTimerRef, performUpdateInfo]);\r\n\r\n  const handleSave = useCallback(() => {\r\n    performUpdateInfo({ username: user.username });\r\n  }, [user]);\r\n\r\n  return (\r\n    <div className=\"account-settings-wrapper\">\r\n      <DefaultLayout>\r\n        <div className=\"account-settings\">\r\n          <div className=\"header\">\r\n            <h1>Account Settings</h1>\r\n          </div>\r\n          <div className=\"account-wrapper\">\r\n            <div className=\"left\">\r\n              <h2>Profile Details</h2>\r\n              <div className=\"input\">\r\n                <label>Username</label>\r\n                <input type=\"text\" placeholder=\"John Doe\" name=\"username\" value={user.username} onChange={handleUserChange} />\r\n              </div>\r\n              <div className=\"input\">\r\n                <label>Email</label>\r\n                <input type=\"email\" placeholder=\"Johndoe@mail.com\" name=\"email\" value={user.email} onChange={handleUserChange} />\r\n              </div>\r\n              <button onClick={handleSave} className={loading.userInfo ? \"loading\" : \"\"} >SAVE</button>\r\n            </div>\r\n            <PasswordUpdate />\r\n\r\n          </div>\r\n          <div className=\"notification-settings\">\r\n            <h2>Notification Settings</h2>\r\n            <p>We will still send you important notifications about your account outside of your notification settings</p>\r\n\r\n            <div className=\"toggle-options\">\r\n              <div>\r\n                <div>\r\n                  <h3>Weekly Newsletters</h3>\r\n                  <div className=\"switch\">\r\n                    <input type=\"checkbox\" checked={checkboxValues.weeklyNews} name=\"weeklyNews\" onChange={handleCheckboxChanges} />\r\n                    <span className=\"slider round\"></span>\r\n                  </div>\r\n                </div>\r\n                <p>These are update promotion about guide and properties\r\n                  every week</p>\r\n              </div>\r\n              <div>\r\n                <div>\r\n                  <h3>Guide Alart</h3>\r\n                  <div className=\"switch\">\r\n                    <input type=\"checkbox\" checked={checkboxValues.guideAlart} name=\"guideAlart\" onChange={handleCheckboxChanges} />\r\n                    <span className=\"slider round\"></span>\r\n                  </div>\r\n                </div>\r\n                <p>Edit, Update or other alart of you save guides</p>\r\n              </div>\r\n              <div>\r\n                <div>\r\n                  <h3>Special Discounts and Benefits</h3>\r\n                  <div className=\"switch\">\r\n                    <input type=\"checkbox\" checked={checkboxValues.special} name=\"special\" onChange={handleCheckboxChanges} />\r\n                    <span className=\"slider round\"></span>\r\n                  </div>\r\n                </div>\r\n                <p>Special discount update on properties near your</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </DefaultLayout>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default AccountSettings"],"sourceRoot":""}