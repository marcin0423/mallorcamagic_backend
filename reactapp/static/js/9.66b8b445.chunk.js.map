{"version":3,"sources":["images/svg/eye.svg","images/svg/key.svg","images/svg/sms.svg","images/login.png","views/Login.js"],"names":["module","exports","__webpack_require__","p","Login","_useState","useState","_useState2","Object","E_Python_MallorcaMagc_clean_for_deploy_mallorcamagic_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_2__","showPassword","setShowPassword","_useState3","email","password","_useState4","formValues","setFormValues","_useState5","_useState6","loading","setLoading","_useState7","_useState8","error","setError","user","useRecoilValue","LoggedUser","_useRecoilState","useRecoilState","AuthToken","setAuthToken","_useSearchParams","useSearchParams","searchParams","navigate","useNavigate","isLoggedIn","_useState9","_useState10","recaptchaToken","setRecaptchaToken","recaptchaRef","useRef","showPasswordHandler","useCallback","handleChange","e","E_Python_MallorcaMagc_clean_for_deploy_mallorcamagic_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__","E_Python_MallorcaMagc_clean_for_deploy_mallorcamagic_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_0__","target","name","value","handleSubmit","axios","post","concat","HOST_NAME","username","recaptcha","then","res","status","data","token","has","get","catch","err","response","finally","current","reset","react__WEBPACK_IMPORTED_MODULE_4___default","a","createElement","className","_containers_DefaultLayout__WEBPACK_IMPORTED_MODULE_11__","coverImage","Wellcome","coverText","_components_Title__WEBPACK_IMPORTED_MODULE_9__","text","react_inlinesvg__WEBPACK_IMPORTED_MODULE_5__","src","Email","type","placeholder","onChange","Password","onClick","Eye","react_google_recaptcha__WEBPACK_IMPORTED_MODULE_17__","sitekey","GOOGLE_RECAPTCHA_SITE_KEY","ref","react_router_dom__WEBPACK_IMPORTED_MODULE_6__","to"],"mappings":"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","file":"static/js/9.66b8b445.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/eye.a325a359.svg\";","module.exports = __webpack_public_path__ + \"static/media/key.fdfd460c.svg\";","module.exports = __webpack_public_path__ + \"static/media/sms.2c09bd0e.svg\";","module.exports = __webpack_public_path__ + \"static/media/login.a9ced1f7.png\";","import axios from 'axios';\r\nimport React, { useCallback, useState, useRef } from 'react';\r\nimport Isvg from 'react-inlinesvg';\r\nimport { Link, useNavigate, useSearchParams } from 'react-router-dom';\r\nimport { useRecoilState, useRecoilValue } from 'recoil';\r\nimport { Title } from '../components/Title';\r\nimport { HOST_NAME, GOOGLE_RECAPTCHA_SITE_KEY } from '../config';\r\nimport { DefaultLayout } from '../containers/DefaultLayout';\r\nimport Wellcome from '../images/login.png';\r\nimport Eye from '../images/svg/eye.svg';\r\nimport Password from '../images/svg/key.svg';\r\nimport Email from '../images/svg/sms.svg';\r\nimport { AuthToken, LoggedUser } from '../recoilState/User';\r\nimport ReCAPTCHA from \"react-google-recaptcha\";\r\n\r\nexport const Login = () => {\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [formValues, setFormValues] = useState({ email: \"\", password: \"\" });\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const [error, setError] = useState(\"\");\r\n  const user = useRecoilValue(LoggedUser);\r\n  const [, setAuthToken] = useRecoilState(AuthToken);\r\n  const [searchParams] = useSearchParams();\r\n  const navigate = useNavigate();\r\n  if (user.isLoggedIn) {\r\n    navigate(\"/account-settings\");\r\n  }\r\n\r\n  // Captcha\r\n  const [recaptchaToken, setRecaptchaToken] = useState(\"\");\r\n  const recaptchaRef = useRef();\r\n\r\n  const showPasswordHandler = useCallback(() => {\r\n    setShowPassword(!showPassword);\r\n  }, [showPassword])\r\n\r\n\r\n  const handleChange = useCallback((e) => {\r\n    setFormValues({ ...formValues, [e.target.name]: e.target.value })\r\n    // console.log(formValues)\r\n  }, [formValues])\r\n\r\n  const handleSubmit = useCallback(() => {\r\n    setLoading(true);\r\n    setError(\"\");\r\n    axios.post(`${HOST_NAME}api/accounts/login/`, { username: formValues.email, password: formValues.password, recaptcha: recaptchaToken })\r\n      .then(res => {\r\n        if (res.status === 200) {\r\n          setAuthToken(res.data.token);\r\n          setError(\"\");\r\n\r\n          if (searchParams.has('next')) navigate(searchParams.get('next'));\r\n          else navigate(\"/\");\r\n        } else {\r\n          setError(\"Incorrect email and/or password\");\r\n        }\r\n      })\r\n      .catch(err => {\r\n        setError(err.response.data.error || \"Incorrect email and/or password\");\r\n      })\r\n      .finally(() => {\r\n        setLoading(false);\r\n        if (recaptchaRef.current) recaptchaRef.current.reset();\r\n      });\r\n  }, [formValues, recaptchaToken, recaptchaRef]);\r\n\r\n  return (\r\n    <div className=\"login-screen-wrapper\">\r\n      <DefaultLayout coverImage={Wellcome} coverText=\"Welcome to Mallorca Magic\">\r\n        <div className=\"login-wrapper\">\r\n          <div>\r\n            <Title text=\"Log In to Your Account\" />\r\n\r\n            {error && <div className=\"error\">{error}</div>}\r\n            <div className=\"login\">\r\n\r\n              <label>Email</label>\r\n              <div className=\"input\">\r\n                <Isvg src={Email} />\r\n                <input type=\"text\" placeholder=\"Type your Email address\" name=\"email\" value={formValues.email} onChange={handleChange} />\r\n              </div>\r\n\r\n              <label>Password</label>\r\n              <div className=\"input\">\r\n                <Isvg src={Password} />\r\n                <input type={showPassword ? \"text\" : \"password\"} placeholder=\"Enter a secure password\" name=\"password\" value={formValues.password} onChange={handleChange} />\r\n                <button onClick={showPasswordHandler}><Isvg src={Eye} /></button>\r\n              </div>\r\n\r\n              <ReCAPTCHA sitekey={GOOGLE_RECAPTCHA_SITE_KEY} onChange={token => setRecaptchaToken(token)} ref={recaptchaRef} />\r\n\r\n              <div className=\"buttons\">\r\n                <div>\r\n                  <Link to=\"/signup\">Sign up</Link>\r\n                  <Link to=\"/forget-password\">Forget Password?</Link>\r\n                </div>\r\n                <button onClick={handleSubmit} className={loading ? 'loading' : ''}>Log In</button>\r\n              </div>\r\n\r\n            </div>\r\n\r\n          </div>\r\n        </div>\r\n      </DefaultLayout>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Login"],"sourceRoot":""}